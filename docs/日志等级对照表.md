# 日志等级对照表

本表说明项目中使用的 Loguru 日志等级含义、适用场景及示例。配置文件中 `config.log.level` 可设为下表任一等级（不区分大小写），设为
`TRACE`/`DEBUG` 时会在控制台输出详细日志。

---

## 等级一览

| 等级           | 数值 | 用途                    | 默认是否输出到控制台       |
|--------------|----|-----------------------|------------------|
| **TRACE**    | 5  | 最细粒度，逐条消息/请求级         | 仅当 level=TRACE 时 |
| **DEBUG**    | 10 | 排查问题时有用，日常可关闭         | 仅当 level=DEBUG 时 |
| **INFO**     | 20 | 关键状态变化，运维/用户关心        | 是                |
| **SUCCESS**  | 25 | 重要成功操作（Loguru 扩展）     | 是                |
| **WARNING**  | 30 | 可恢复的异常或降级             | 是                |
| **ERROR**    | 40 | 需要关注的失败               | 是                |
| **CRITICAL** | 50 | 严重错误，当前实现会触发 exit(-1) | 是                |

---

## 各等级说明与示例

### TRACE

- **用途**：开发/抓包时查看每条消息、每次请求等极细粒度信息，生产环境建议关闭。
- **本项目中示例**：
    - WebSocket 每次广播内容：`Broadcast message: {msg}`
    - WebSocket 收到客户端消息：`Received message from {remote_address}`
    - HTTP 请求/响应：`Send http request: ...`、`Received http response: ...`
    - HTTP 客户端初始化及耗时：`Initializing http client`、`Initialize http client cost ...s`
    - 收到语音包（callsign、频率、长度）

---

### DEBUG

- **用途**：诊断用，如设备切换、流水线启停、队列状态、编解码器创建等，正常运行时可不看。
- **本项目中示例**：
    - **音频/设备**：麦克风采集启停、单路/混合播放启停、输入/输出设备切换、transmitter 添加与输出切换
    - **队列/丢包**：冲突队列已满丢弃提示音、输出队列已满丢弃包、Transmitter 队列已满丢弃帧、重采样帧长不一致
    - **网络**：收到 Pong、WebSocket 客户端断开与当前连接数、WebSocket 连接已关闭
    - **配置/启动**：配置 save callback 注册、日志级别变更、主窗口创建、正在登录、登录成功详情、音频驱动/设备变更、使用默认音频驱动
    - **OPUS**：OPUS decoder/encoder 创建（采样率、声道、帧长）

---

### INFO

- **用途**：重要状态变化，适合作为“运行日记”：谁连上了、服务何时启停等。
- **本项目中示例**：
    - WebSocket 客户端连接：`WebSocket 客户端连接: {address}, ID: {client_id}, 当前连接数: {len}`
    - WebSocket 服务启停：`WebSocket 服务已启动 ws://...`、`WebSocket 服务已停止`

---

### SUCCESS

- **用途**：重要成功操作，比 INFO 更突出（Loguru 扩展等级）。
- **本项目中示例**：
    - 登录成功：`登录成功, 用户: {username}({cid})`
    - FSUIPC 连接成功：`FSUIPC connection established`

---

### WARNING

- **用途**：可恢复的异常或降级，不影响主流程但应留意。
- **本项目中示例**：
    - 音频驱动未找到但会尝试其他驱动：`音频驱动未找到: {driver_name}`
    - 配置版本小版本不一致：`Config version not match! Require ... but got ...`
    - WebSocket 广播超时：`Broadcast timeout`

---

### ERROR

- **用途**：需要关注的失败，如连接失败、解析失败、编解码失败等。
- **本项目中示例**：
    - **网络/信令**：服务端错误、解析/处理控制消息失败、处理语音包失败、WebSocket 广播失败、处理连接失败
    - **音频**：启动录音/播放/混合播放失败、OPUS 编解码错误
    - **配置**：未找到默认音频驱动、配置保存回调失败
    - **FSUIPC**：找不到/加载 libfsuipc 失败、连接失败、获取频率错误、错误过多断开
    - **业务**：账号密码未填、登录 HTTP 状态码异常、获取管制列表状态码异常
    - **日志**：配置的 log level 无效时

---

### CRITICAL

- **用途**：严重错误，当前实现会触发进程退出（`exit(-1)`）。
- **本项目中示例**：
    - 配置版本不兼容（主/次版本不符）：`Config version error! Require ... but got ...`

---

## 配置方式

在配置文件中设置 `log.level`（或通过应用内配置界面选择日志级别），可选值（不区分大小写）：

- `TRACE` — 最详细，含所有 TRACE/DEBUG/INFO/...
- `DEBUG` — 排查问题时推荐
- `INFO` — 默认推荐，日常运行
- `WARNING` — 仅警告及以上
- `ERROR` — 仅错误及以上
- `CRITICAL` — 仅严重错误

无效值会回退为 `INFO`，并打一条 ERROR 日志。
